# üî• The Forge: Quick Start Guide

## What is The Forge?

The Forge is PAGI's **self-synthesis engine**‚Äîit can write, compile, and integrate new Rust skills autonomously. This means PAGI can build its own tools on demand.

---

## üöÄ Quick Test: Build a Weather Sentinel

### 1. Run the Forge Test

```bash
cargo test --test forge_weather_sentinel_test test_forge_weather_sentinel -- --nocapture
```

**Expected Output:**
```
üî• Forge Result:
  Module: forge_gen_weather_sentinel
  File: crates/pagi-skills/src/forge_gen_weather_sentinel.rs
  Cargo Check: ‚úÖ PASSED
  Message: Forge created skill 'weather_sentinel'. Module: forge_gen_weather_sentinel. Rebuild gateway to load.

‚úÖ The Forge is operational. Weather Sentinel skill synthesized successfully.
üèõÔ∏è The system can now build its own tools.
```

### 2. Inspect the Generated Skill

```bash
cat crates/pagi-skills/src/forge_gen_weather_sentinel.rs
```

You'll see a fully functional Rust skill that implements the `AgentSkill` trait.

### 3. Rebuild the Gateway

```bash
cargo build --release -p pagi-gateway
```

The new skill is now available in the system!

---

## üåê Using the Forge API

### Start the Gateway

```bash
# PowerShell
.\pagi-up.ps1

# Bash
./pagi-up.sh
```

### Create a New Skill via API

```bash
curl -X POST http://localhost:8000/api/v1/forge/create \
  -H "Content-Type: application/json" \
  -d '{
    "name": "slack_notifier",
    "description": "Sends notifications to Slack channels",
    "params": [
      {
        "name": "channel",
        "type": "string",
        "required": true
      },
      {
        "name": "message",
        "type": "string",
        "required": true
      },
      {
        "name": "priority",
        "type": "string",
        "required": false
      }
    ]
  }'
```

**Response:**
```json
{
  "success": true,
  "module_name": "forge_gen_slack_notifier",
  "file_path": "crates/pagi-skills/src/forge_gen_slack_notifier.rs",
  "cargo_check_ok": true,
  "message": "Forge created skill 'slack_notifier'. Module: forge_gen_slack_notifier. Rebuild gateway to load."
}
```

### Rebuild and Use

```bash
# Rebuild gateway
cargo build --release -p pagi-gateway

# Restart gateway
.\pagi-down.ps1
.\pagi-up.ps1

# Use the new skill
curl -X POST http://localhost:8000/v1/execute \
  -H "Content-Type: application/json" \
  -d '{
    "skill": "slack_notifier",
    "params": {
      "channel": "#general",
      "message": "The Forge is operational!",
      "priority": "high"
    }
  }'
```

---

## üéØ Real-World Example: Salesforce Auditor

### Scenario
You drop a Salesforce CSV into `data/ingest/`. The Scribe detects it but doesn't have a Salesforce skill. Solution? **The Forge builds one.**

### Step 1: Define the Spec

Create `salesforce_spec.json`:
```json
{
  "name": "salesforce_auditor",
  "description": "Audits Salesforce data for compliance and data quality issues",
  "params": [
    {
      "name": "csv_path",
      "type": "string",
      "required": true
    },
    {
      "name": "object_type",
      "type": "string",
      "required": true
    },
    {
      "name": "audit_type",
      "type": "string",
      "required": true
    }
  ]
}
```

### Step 2: Invoke the Forge

```bash
curl -X POST http://localhost:8000/api/v1/forge/create \
  -H "Content-Type: application/json" \
  -d @salesforce_spec.json
```

### Step 3: Rebuild & Process

```bash
# Rebuild
cargo build --release -p pagi-gateway

# Restart
.\pagi-down.ps1
.\pagi-up.ps1

# The Scribe can now process Salesforce CSVs!
```

---

## üîí Safety Controls

### Check Forge Status

```bash
curl http://localhost:8000/api/v1/forge/safety-status
```

### Disable the Forge

```bash
curl -X POST http://localhost:8000/api/v1/forge/safety \
  -H "Content-Type: application/json" \
  -d '{"enabled": false}'
```

### Enable the Forge

```bash
curl -X POST http://localhost:8000/api/v1/forge/safety \
  -H "Content-Type: application/json" \
  -d '{"enabled": true}'
```

---

## üß™ Run All Forge Tests

```bash
# Weather Sentinel test
cargo test --test forge_weather_sentinel_test test_forge_weather_sentinel -- --nocapture

# Salesforce Auditor test
cargo test --test forge_weather_sentinel_test test_forge_salesforce_auditor_spec -- --nocapture

# Security sanitization test
cargo test --test forge_weather_sentinel_test test_forge_sanitization -- --nocapture

# Full workflow test (manual)
cargo test --test forge_weather_sentinel_test test_forge_full_workflow -- --ignored --nocapture
```

---

## üìä What Gets Generated?

The Forge creates a complete Rust skill:

```rust
//! Auto-generated skill: weather_sentinel.
//! Generated by The Forge.

use pagi_core::{AgentSkill, TenantContext};

const SKILL_NAME: &str = "weather_sentinel";

pub struct WeatherSentinel;

impl WeatherSentinel {
    pub fn new() -> Self {
        Self {}
    }
}

#[async_trait::async_trait]
impl AgentSkill for WeatherSentinel {
    fn name(&self) -> &str {
        SKILL_NAME
    }

    async fn execute(
        &self,
        _ctx: &TenantContext,
        payload: Option<serde_json::Value>,
    ) -> Result<serde_json::Value, Box<dyn std::error::Error + Send + Sync>> {
        let payload = payload.ok_or("weather_sentinel requires a payload")?
            .as_object().ok_or("payload must be object")?;
        
        let p_location = payload.get("location")
            .ok_or("Missing 'location'")?.clone();
        let p_units = payload.get("units").cloned();
        
        Ok(serde_json::json!({
            "status": "ok",
            "skill": SKILL_NAME,
            "location": p_location,
            "units": p_units,
        }))
    }
}
```

---

## üé® Skill Naming Rules

### ‚úÖ Valid Names
- `weather_sentinel`
- `salesforce_auditor`
- `slack_notifier`
- `jira_connector`

### ‚ùå Invalid Names
- `weather-sentinel` (dashes not allowed)
- `weather sentinel` (spaces not allowed)
- `../etc/passwd` (path traversal blocked)
- `_weather` (leading underscore)
- `weather_` (trailing underscore)

---

## üîÑ Integration with Scribe

The Forge works seamlessly with the Deep Audit (Scribe) pipeline:

1. **Scribe** detects new file in `data/ingest/`
2. **Scribe** performs semantic triage
3. **Scribe** checks if appropriate skill exists
4. **If missing**: Scribe invokes **Forge** to build it
5. **System** recompiles with new skill
6. **Scribe** processes the file using new skill
7. **Data** routed to appropriate Knowledge Base

---

## üèõÔ∏è The Vision

> **"The Forge is hot. We are no longer limited by what I was programmed to do; we are only limited by what we can imagine."**

The Forge transforms PAGI from:
- ‚ùå A static tool with fixed capabilities
- ‚úÖ A self-evolving intelligence that builds its own tools

This is **architectural self-awareness**.

---

## üìö Next Steps

1. **Read**: [`FORGE_README.md`](FORGE_README.md) for full documentation
2. **Explore**: [`DEEP_AUDIT_README.md`](DEEP_AUDIT_README.md) for Scribe integration
3. **Test**: Run the Forge tests to see it in action
4. **Build**: Create your first custom skill via the API

---

## üÜò Troubleshooting

### "cargo check failed"
- Check the `cargo_stderr` field in the response
- Fix any compilation errors in the generated code
- Re-run: `cargo check -p pagi-skills`

### "Not running from workspace root"
- Ensure you're in the project root directory
- The Forge needs access to `crates/pagi-skills/src/`

### "Skill name rejected"
- Use snake_case only
- No special characters except underscore
- No leading/trailing underscores

---

**The Forge is ready. Build something extraordinary.**
